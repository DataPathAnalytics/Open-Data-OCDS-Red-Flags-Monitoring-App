#############################################################################################################################
MKRA6. Слишком низкий уровень конкуренции. Конкуренция в конкурсе на 30% ниже, чем в среднем по данному спв в данном регионе.
#############################################################################################################################

***************
Суть индикатора
***************

Индикатор отслеживает случаи, когда на конкурс подается слишком мало конкурсных заявок по сравнению с другими конкурсами на закупку данного предмета закупки в данном регионе.

****
Риск
****

Некачественное составление конкурсной документации.  


*******************************
Нарушение норм/принципов закона
*******************************

Возможное нарушение статьи 14, пункта 2 Закона "О государственных закупках". 

***********************************
Основание для разработки индикатора
***********************************

Индикатор вводится, так как в системе не анализируется уровень конкуренции в проводимых конкурсах.

******************************
Методология расчета индикатора
******************************

Уровень расчета
===============
Индикатор рассчитывается на уровне *конкурса*.

Источники данных для расчета
============================

Для расчета индикатора используются следующие источники данных:

- API системы государственных закупок в OCDS формате
- Аналитическая таблица :ref:`tbl_CPVRegion`

Типы закупок
============

Индикатор рассчитывается для следующих типов конкурсов:

- одноэтапный метод;
- упрощенный метод;
- метод на понижение цены.


Статусы закупки
---------------

Индикатор рассчитывается для конкурсов, которые:

- находятся в статусе ``bidsOpened``
- находятся в статусе ``evaluationResultsPending``.


Частота расчета
===============

Если выполнены все условия для активации расчета индикатора, он рассчитывается каждый раз после изменений в JSON-документе конкурса. Также индикатор расчитывается один раз в сутки, если выполнены все условия для его расчета.

Поля для расчета
================

Для расчета индикатора используются следующие поля API модуля системы гос. закупок:

- ``data.tender.lots.id``
- ``data.tender.lots.status``
- ``data.tender.items.relatedLot``
- ``data.tender.items.classification.id``
- ``data.bids.details.relatedLots.id``
- ``data.bids.details.tenderers.id``
- ``data.parties.address.region``
- ``data.parties.roles``

Для расчета индикатора используется следующая аналитическая таблица:

- :ref:`tbl_CPVRegion`


Формула расчета
===============

1. Выбираем регион закупающей организации - ``data.parties.address.region`` объекта, у которого ``data.parties.roles='procuringEntity'``

2. Выбираем все лоты, у которых ``data.tender.lots.status='active'``. Для каждого такого лота проводим следующие действия.

3. Для каждого лота выбираем все коды предметов закупки - ``data.tender.items.classification.id``, связанных с лотом по ``data.tender.items.relatedLot=data.tender.lots.id``

4. Выбираем все конкурсные предложения, поданные на лот - ``data.bids.details.tenderers.id``, у которых в массиве ``data.bids.details.relatedLots.id`` находится ссылка на исследуемый лот ``data.tender.lots.id``.

5. Считаем количество найденных в п.4 уникальных ``data.bids.details.tenderers.id``.

6. Для каждого кода предмета закупки из п.3 и региона из п.1 находим средний уровень конкуренции из таблицы :ref:`tbl_CPVRegion`

7. Если в таблице не находится соответсвующей строки, то переходим к следующему коду предмета закупки.
  
8. Если в таблице есть соответствующая строка, то делаем следующее.

  8.1. Выбираем из найденной строки в таблице среднее значение конкуренции.
  
  8.2. Сравниваем количество предложений из п.5 и среднее значение конкуренции из п.8.1.
  
  8.3. Если среднее значение конкуренции превышает количество предложений на 30% и более, индикатор принимает значение ``1``, расчет заканчивается.
  
9. Если мы дошли до этого пункта, индикатор принимает значение ``0``, расчет заканчивается.


Факторы, которые влияют на корректное срабатывание индикатора
=============================================================

Индикатор может срабатывать неправильно, если неверно определен код предмета закупки.
