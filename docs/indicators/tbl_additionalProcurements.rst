.. _tbl_additionalProcurements:

tbl_additionalProcurements
==========================

Данная аналитическая таблица хранит все предметы закупки, которые дозакупади закупающие организации, используя метод прямого заключения договора.

Данная аналитическая таблица содержит следующую информацию:
 - Идентификатор закупающей организации.
 - Код предмета закупки.
 
Пример того, как может выглядеть таблица:

====================== ======================
Закупающая организация Код предмета закупки
---------------------- ----------------------
Идентификатор 1        Код предмета закупки 1
Идентификатор 1        Код предмета закупки 2
Идентификатор 2        Код предмета закупки 3
Идентификатор 2        Код предмета закупки 4
Идентификатор 3        Код предмета закупки 5
...                    ...
====================== ======================

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате
- Транзакционная переменная :ref:`tv_tenderCPVList`

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.


Качество данных
---------------

Индикатор расчитывается только для конкурсов, у которых значение переменной ``tv_badQuality=0``.


****************
Поля для расчета
****************

- ``data.tender.procurementMethodRationale``
- ``data.tender.procurementMethodDetails``
- ``data.tender.statusDetails``
- ``data.tender.datePublished``
- ``data.parties.id``
- ``data.parties.roles``

Для расчета используется следующая транзакционная переменная:

- :ref:`tv_tenderCPVList`

***********************
Формула расчета таблицы
***********************

1. Выбираем только закупки, у которых ``data.tender.procurementMethodRationale='additionalProcurement5'``, год из даты ``data.tender.datePublished`` равен текущему и ``data.tender.statusDetails='contractSigned'``.

2. Для каждой найденной закупки проводим следующие действия.

3. Выбираем идентификатор закупающей организации - ``data.parties.id``, где ``data.parties.roles='buyer'``.

4. Выбираем все коды предметов закупки данной закупки из транзакционной переменной :ref:`tv_tenderCPVList`

9. Идентификатор закупающей организации и каждый код предмета закупки записываем в таблицу.
