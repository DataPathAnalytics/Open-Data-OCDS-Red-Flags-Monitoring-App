.. _tbl_CPVRegion:

tbl_CPVRegion
=============

Данная аналитическая таблица хранит средний уровень конкуренции по всем предметам закупки в различных регионах за текущий год.

Данная аналитическая таблица содержит следующую информацию:
 - Название региона.
 - Код предмета закупки.
 - Средний уровень конкуренции.
 
Пример того, как может выглядеть таблица:

================== ====================== =============================
Название региона   Код предмета закупки   Средний уровень конкуренции
------------------ ---------------------- -----------------------------
Название региона 1 Код предмета закупки 1 Средний уровень конкуренции 1
Название региона 1 Код предмета закупки 2 Средний уровень конкуренции 2
Название региона 1 Код предмета закупки 3 Средний уровень конкуренции 3
Название региона 2 Код предмета закупки 4 Средний уровень конкуренции 4
Название региона 2 Код предмета закупки 5 Средний уровень конкуренции 5
...                ...                    ... 
================== ====================== =============================

****************************
Расчет аналитической таблицы
****************************

****************************
Источники данных для расчета
****************************

Для расчета аналитической таблицы используются следующие источники данных:

- API системы государственных закупок в OCDS формате.

*************************************
Частота расчета аналитической таблицы
*************************************

Аналитическая таблица рассчитывается 1 раз в сутки.

****************
Поля для расчета
****************

- ``data.tender.lots.id``
- ``data.tender.lots.status``
- ``data.tender.items.relatedLot``
- ``data.tender.items.classification.id``
- ``data.bids.details.relatedLots.id``
- ``data.bids.details.tenderers.id``
- ``data.parties.address.region``
- ``data.parties.roles``

***********************
Формула расчета таблицы
***********************

1. Перед расчетом таблица очищается.

2. Выбираем только процедуры, у которых ``data.tender.procurementMethodDetails`` принимает одно из значений: ``oneStage``, ``simplicated``, ``downgrade``.

3. Выбираем только завершенные процедуры ``data.tender.status = 'complete'`` или те, что находятся в статусе ``data.tender.status = 'active'``, но имеют ``statusDetails = 'evaluationComplete'`` более 30 дней.

4. Выбираем регион закупающей организации - ``data.parties.address.region`` объекта, у которого ``data.parties.roles='procuringEntity'``

5. Выбираем все лоты, у которых ``data.tender.lots.status='active'``. Для каждого такого лота проводим следующие действия.

6. Для каждого лота выбираем все коды предметов закупки - ``data.tender.items.classification.id``, связанных с лотом по ``data.tender.items.relatedLot=data.tender.lots.id``

7. Выбираем все конкурсные предложения, поданные на лот - ``data.bids.details.tenderers.id``, у которых в массиве ``data.bids.details.relatedLots.id`` находится ссылка на исследуемый лот ``data.tender.lots.id``.

8. Считаем количество найденных в п.4 уникальных ``data.bids.details.tenderers.id``.

9. Проведя п.1-п.8 по всем лотам из подходящих для анализа конкурсов группируем итоговые данные по региону и коду предмета закупки и выбираем среднее из найденных в п.8 значений.
